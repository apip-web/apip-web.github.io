---
layout: post
title: "Gallery Keluarga"
author: Apip
tags: gallery
description: "Halaman berisi gallery keluarga"
---

<div class="gallery gallery-1"></div>

---

<div class="gallery gallery-2"></div>

<style>
.gallery {
  column-count: 2;
  column-gap: 12px;
}

.gallery a {
  display: inline-block; /* Wajib */
  width: 100%;
  margin-bottom: 12px;
  break-inside: avoid; /* Mencegah gambar terpotong/melompat antar kolom */
  background-color: #1a1a1a; /* Placeholder warna agar tidak kosong melompong */
  border-radius: 8px;
  overflow: hidden;
}

.gallery img {
  width: 100%;
  height: auto;
  display: block;
  /* Transisi halus saat gambar muncul */
  opacity: 0;
  transition: opacity 0.3s ease-in;
}

/* Munculkan gambar setelah src terisi */
.gallery img[src] {
  opacity: 1;
}
</style>

<script>
(function () {
  const CLOUD_NAME = 'dpawix5pp';
  const MAX_WIDTH = 1200;

  const galleries = [
    { selector: '.gallery-1', start: 1, end: 6 },
    { selector: '.gallery-2', start: 7, end: 12 }
  ];

  galleries.forEach(g => {
    const container = document.querySelector(g.selector);
    if (!container) return;

    for (let i = g.start; i <= g.end; i++) {
      const num = String(i).padStart(3, '0');
      const publicId = `gallery-${num}`;

      const img = document.createElement('img');
      img.alt = `Gallery ${num}`;
      img.loading = 'lazy';
      img.dataset.cld = publicId;

      const a = document.createElement('a');
      // Gunakan .jpg dummy agar browser tidak bingung (masalah teks kemarin)
      a.href = `https://res.cloudinary.com/${CLOUD_NAME}/image/upload/f_auto,q_auto/${publicId}.jpg`;
      a.setAttribute('data', 'pop');
      a.appendChild(img);

      container.appendChild(a);
    }
  });

  function cloudinaryURL(publicId, width) {
    return `https://res.cloudinary.com/${CLOUD_NAME}/image/upload/f_auto,q_auto,w_${width}/${publicId}.avif`;
  }

  function updateImages() {
    const galleryElems = document.querySelectorAll('.gallery');
    if (galleryElems.length === 0) return;

    // Hitung estimasi lebar satu kolom (50% dari kontainer)
    const containerWidth = galleryElems[0].clientWidth;
    const colWidth = Math.floor(containerWidth / 2); 
    const dpr = window.devicePixelRatio || 1;
    const finalWidth = Math.min(Math.round(colWidth * dpr), MAX_WIDTH);

    document.querySelectorAll('img[data-cld]').forEach(img => {
      const id = img.dataset.cld;
      const newSrc = cloudinaryURL(id, finalWidth);
      
      if (img.src !== newSrc) {
        img.src = newSrc;
      }
    });
  }

  // Gunakan ResizeObserver untuk deteksi ukuran yang lebih akurat daripada resize biasa
  if (window.ResizeObserver) {
    const ro = new ResizeObserver(() => updateImages());
    galleries.forEach(g => {
      const el = document.querySelector(g.selector);
      if (el) ro.observe(el);
    });
  } else {
    window.addEventListener('resize', updateImages);
  }

  // Jalankan pertama kali
  setTimeout(updateImages, 100);
})();
</script>
