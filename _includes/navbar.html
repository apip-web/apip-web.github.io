<style>
#theme-switcher {
  color: var(--text-main);
  text-decoration: none;
  font-size: 28px;
  font-weight: 700;
  letter-spacing: 3px;
  text-transform: uppercase;
  transition: all 0.3s ease;
}

#theme-switcher:hover {
  color: var(--accent);
}

.theme-btn {
  position: relative;
  width: 100%;
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 10px 28px 10px 10px;
  text-align: left;
  background: transparent;
  border: none;
  color: var(--text-main);
  cursor: pointer;
}

.theme-icon svg {
  width: 18px;
  height: 18px;
  stroke: currentColor;
  fill: none;
  stroke-width: 1.8;
}

.theme-btn[data-theme-btn="dark"] svg,
.theme-btn[data-theme-btn="darkblue"] svg {
  fill: currentColor;
  stroke: none;
}

.theme-btn.active::after {
  content: "âœ”";
  position: absolute;
  right: 12px;
  top: 50%;
  transform: translateY(-60%);
  font-size: 14px;
  color: white;
}

.theme-btn.active {
  background: var(--accent);
  color: #fff;
  box-shadow: inset 0 0 0 1px rgba(255,255,255,.25);
}

.theme-btn.active:hover {
  background: var(--accent-hover);
}

.about-container {
  margin: 0;
  max-height: 400px;
  background: transparent;
  padding: 0;
  font-size: 80%;
}

.about-header {
  display: flex;
  align-items: center;
  gap: 25px;
}

.about-header img {
  width: 120px;
  height: 120px;
  border-radius: 50%;
  object-fit: cover;
  border: 2px solid var(--hr);
  margin-top: 40px;
}

.about-header ul {
  margin: 0;
  padding: 0;
  list-style: none;
}

.about-header li {
  font-size: 14px;
  margin-bottom: 5px;
  line-height: 1;
}
</style>

<nav id="navbar">
        <div class="nav-container">
<a href="/" class="logo-link">
  <svg class="logo-svg" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
    <defs>
        <linearGradient id="logoGrad" x1="0%" y1="0%" x2="100%" y2="100%">
            <stop offset="0%" style="stop-color: var(--logo-primary); stop-opacity:1" />
            <stop offset="100%" style="stop-color: var(--logo-accent); stop-opacity:1" />
        </linearGradient>
    </defs>
    <polygon class="logo-shape" points="50,10 20,50 50,90 80,50" stroke="url(#logoGrad)" stroke-width="3" fill="none" />
    <circle class="logo-dot" cx="50" cy="50" r="5" fill="url(#logoGrad)"/>
  </svg>
    <span class="logo-text">NOIR</span>
</a>

            <div class="menu-toggle" id="menuToggle">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
    </nav>

    <div class="mobile-nav" id="mobileNav">
        <ul class="mobile-nav-links">
            <li><a href="/">Home</a></li>
            <li><span id="theme-switcher">Switch Theme</span></li>
            <li><span id="toggle-debug">Show <code>Debug</code></span></li>
            <li><a href="javascript:void(0)" onclick="openAbout()">About</a></li>
            <li class="nav-item"><a href="#" id="search-trigger" class="nav-link"><i class="icon-search"></i> Search</a></li>
        </ul>
    </div> 

<div id="themeModal" class="modal">
    <div class="modal-content">
        <h3 style="margin-bottom: 10px;">Appearance</h3>
        <p style="font-size: 14px; color: var(--text-muted);">Pilih tema tampilan website</p>
        <div class="theme-options">

<button class="theme-btn" data-theme-btn="light" onclick="setTheme('light')">
  <span class="theme-icon">
    <!-- LIGHT ICON -->
    <svg viewBox="0 0 24 24" aria-hidden="true">
      <circle cx="12" cy="12" r="4"/>
      <path d="M12 2v2M12 20v2M4.9 4.9l1.4 1.4M17.7 17.7l1.4 1.4M2 12h2M20 12h2M4.9 19.1l1.4-1.4M17.7 6.3l1.4-1.4"/>
    </svg>
  </span>
  <span class="theme-label">Light</span>
</button>

<button class="theme-btn" data-theme-btn="dark" onclick="setTheme('dark')">
  <span class="theme-icon">
    <!-- DARK ICON -->
    <svg viewBox="0 0 24 24" aria-hidden="true">
      <path d="M21 12.8A9 9 0 1111.2 3 7 7 0 0021 12.8z"/>
    </svg>
  </span>
  <span class="theme-label">Dark</span>
</button>

<button class="theme-btn" data-theme-btn="darkblue" onclick="setTheme('darkblue')">
  <span class="theme-icon">
    <!-- BLUE ICON -->
    <svg viewBox="0 0 24 24" aria-hidden="true">
      <path d="M12 2a7 7 0 00-7 7c0 5.25 7 13 7 13s7-7.75 7-13a7 7 0 00-7-7z"/>
    </svg>
  </span>
  <span class="theme-label">Dark Blue</span>
</button>

        </div>
        <button onclick="closeModal()" style="background:none; border:1px solid var(--border-tag); color:var(--text-muted); margin-top:20px; cursor:pointer;">Close</button>
    </div>
</div>

<!-- A B O U T -->
<div id="aboutModal" class="modal">
    <div class="modal-content">
<div class="about-container">
  <div class="about-header">
  <img src="/assets/img/profile.webp" alt="Profile Picture" loading="lazy">
    <div>
      <h1>Apip</h1>
      <ul>
  <li>Web tinkerer</li>
  <li>Android modder</li>
  <li>Loves clean UI</li>
</ul>
    </div>
  </div>

<h2 class="about-section-title">About Me</h2>
<p>
  I love experimenting with HTML, CSS, and JavaScript, as well as modifying Android apps directly from my phone.  
  I also build small systems like tooltips, popups, RSS readers, static blogs on GitHub Pages, and various other UI components. Game modding, etc.
</p>

</div>
</div>
</div>

<!-- S E A R C H -->
<div id="search-popup" class="popup-overlay" style="display:none;">
    <div class="popup-content search-box">
        <div class="search-header">
            <input type="text" id="quick-search" placeholder="Cari artikel..." autocomplete="off">
            <button class="close-popup">&times;</button>
        </div>
        <div id="search-results-list">
            </div>
    </div>
</div>

<!-- THEME SWITCHER -->
<script>
const modal = document.getElementById("themeModal");
const modalContent = modal.querySelector(".modal-content");
const themeBtn = document.getElementById("theme-switcher");

// Fungsi Buka
themeBtn.onclick = () => {
    modal.classList.add("active");
    modalContent.classList.remove("animate-out");
    modalContent.classList.add("animate-in");
};

// Fungsi Tutup (Dengan Animasi)
function closeModal() {
    modalContent.classList.remove("animate-in");
    modalContent.classList.add("animate-out");

    // Tunggu animasi selesai (300ms sesuai CSS) baru hilangkan display
    setTimeout(() => {
        modal.classList.remove("active");
    }, 300); 
}

// Tutup jika klik luar
window.onclick = (event) => {
    if (event.target == modal) {
        closeModal();
    }
};

// Helper Kecil
function updateThemeActive(mode) {
  document.querySelectorAll('.theme-btn').forEach(btn => {
    btn.classList.toggle(
      'active',
      btn.dataset.themeBtn === mode
    );
  });
}

// Theme Logic
function setTheme(mode) {
  document.documentElement.setAttribute('data-theme', mode);
  localStorage.setItem('theme', mode);
  updateThemeActive(mode);
  // closeModal();
}

// Init on Load
const savedTheme = localStorage.getItem('theme') || 'light';
document.documentElement.setAttribute('data-theme', savedTheme);
updateThemeActive(savedTheme);
</script>

<!-- A B O U T -->
<script>
const aboutModal = document.getElementById("aboutModal");
const aboutContent = aboutModal.querySelector(".modal-content");

function openAbout() {
    aboutModal.classList.add("active");
    aboutContent.classList.remove("animate-out");
    aboutContent.classList.add("animate-in");
    
    // Tutup sidebar otomatis jika sedang terbuka (khusus mobile)
    if(typeof menuToggle !== 'undefined') {
        menuToggle.classList.remove('active');
        mobileNav.classList.remove('active');
    }
}

function closeAbout() {
    aboutContent.classList.remove("animate-in");
    aboutContent.classList.add("animate-out");
    setTimeout(() => {
        aboutModal.classList.remove("active");
    }, 300);
}

// Tambahkan ke event click window yang sudah ada
window.onclick = (event) => {
    if (event.target == modal) closeModal(); // Untuk theme modal
    if (event.target == aboutModal) closeAbout(); // Untuk about modal
};
</script>

<!-- S E A R C H -->
<script>
document.getElementById('search-trigger').addEventListener('click', (e) => {
    e.preventDefault();
    togglePopup('search-popup', true); // Gunakan fungsi reusable kamu
});

const searchInput = document.getElementById('quick-search');
const resultsArea = document.getElementById('search-results-list');

searchInput.addEventListener('input', () => {
    const keyword = searchInput.value.toLowerCase();
    resultsArea.innerHTML = '';

    if (keyword.length < 2) return;

    // Filter berdasarkan post yang sudah diload oleh SPA
    const filtered = getPosts().filter(p => {
        const title = p.querySelector('.post-title').innerText.toLowerCase();
        return title.includes(keyword);
    });

    filtered.forEach(p => {
        const item = document.createElement('div');
        item.className = 'search-item';
        item.innerHTML = `<span>${p.querySelector('.post-title').innerText}</span>`;
        
        item.onclick = () => {
            togglePopup('search-popup', false);
            router(p.dataset.url, true); // Panggil router SPA agar navigasi mulus
        };
        resultsArea.appendChild(item);
    });
});
</script>
