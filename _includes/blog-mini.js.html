<style>  
  #spa-home { display: block; }  
  #posts { display: none; }  
</style>  
  
<div id="page-404" style="display:none;">  
    <h1>404</h1>  
    <p>Halaman tidak ditemukan.</p>  
    <a href="/">Kembali ke Home</a>  
</div>  
  
<div id="posts" style="display:none;">  
{% for post in site.posts %}  
  <article class="post" data-url="{{ post.url | relative_url }}">  
    <h2 class="post-title">  
      <a href="{{ post.url | relative_url }}">{{ post.title }}</a>  
    </h2>  
  
    <div class="post-excerpt">  
      {{ post.excerpt }}  
    </div>  
  
    <div class="post-content" style="display:none;">  
      {% include post-meta.html post=post %}  
    </div>  
  </article>  
{% endfor %}  
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {

  const homepage  = document.querySelector('.homepage');
  const postsWrap = document.getElementById('posts');
  const posts     = [...document.querySelectorAll('.post')];
  const page404   = document.getElementById('page-404');
  const btn       = document.getElementById('open-blog');
  const BLOG_PATH = '/blog/';

  function safe(el, fn){ if(el) fn(el); }

  /* ========= RESET TOTAL ========= */
  function resetPosts() {
    posts.forEach(p => {
      p.style.display = 'block'; // ← penting
      safe(p.querySelector('.post-content'), el => el.style.display = 'none');
      safe(p.querySelector('.post-excerpt'), el => el.style.display = 'block');
      safe(p.querySelector('.post-title a'), el => el.style.display = '');
    });
  }

  function hideAll() {
    safe(postsWrap, el => el.style.display = 'none');
    safe(page404, el => el.style.display = 'none');
    posts.forEach(p => p.style.display = 'none');
  }

  /* ========= HOMEPAGE ========= */
  function showHome(push){
    safe(homepage, el => el.style.display = '');
    hideAll();
    if(push) history.pushState(null,'','/');
  }

  /* ========= BLOG LIST ========= */
  function showList(push){
    safe(homepage, el => el.style.display = 'none');
    hideAll();
    safe(postsWrap, el => el.style.display = 'block');

    resetPosts(); // ← INI FIX UTAMANYA

    if(push) history.pushState(null,'',BLOG_PATH);
  }

  /* ========= SINGLE POST ========= */
  function showPost(path, push){
    safe(homepage, el => el.style.display = 'none');
    hideAll();
    safe(postsWrap, el => el.style.display = 'block');

    let found = false;

    posts.forEach(p => {
      if (p.dataset.url !== path) return;
      found = true;
      p.style.display = 'block';
      safe(p.querySelector('.post-content'), el => el.style.display = 'block');
      safe(p.querySelector('.post-excerpt'), el => el.style.display = 'none');
      safe(p.querySelector('.post-title a'), el => el.style.display = 'none');
    });

    if(!found) return false;
    if(push) history.pushState(null,'',path);
    return true;
  }

  function show404(path, push){
    hideAll();
    safe(page404, el => el.style.display = 'block');
    if(push) history.pushState(null,'',path);
  }

  /* ========= ROUTER ========= */
  function router(path = location.pathname, push = false){

    if(path.startsWith('/page/')) return;

    if(path === '/' || path === ''){
      showHome(push);
      return;
    }

    if(path === BLOG_PATH){
      showList(push);
      return;
    }

    if(showPost(path, push)) return;

    show404(path, push);
  }

  /* ========= INTERCEPT ========= */
  document.querySelectorAll('a[href^="/"]').forEach(a=>{
    const href = a.getAttribute('href');
    if(href.startsWith('/page/')) return;
    a.addEventListener('click', e=>{
      e.preventDefault();
      router(href,true);
    });
  });

  if(btn){
    btn.addEventListener('click', e=>{
      e.preventDefault();
      router(BLOG_PATH,true);
    });
  }

  window.addEventListener('popstate', ()=>{
    router(location.pathname,false);
  });

  router(location.pathname,false);
});
</script>
