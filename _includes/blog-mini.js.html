<div id="page-404" style="display:none;">
    <h1>404</h1>
    <p>Halaman tidak ditemukan.</p>
    <a href="/">Kembali ke Home</a>
</div>

<div id="posts" style="display:none;">
{% for post in site.posts %}
  <article class="post" data-url="{{ post.url | relative_url }}">
    <h2 class="post-title">
      <a href="{{ post.url | relative_url }}">{{ post.title }}</a>
    </h2>

    <div class="post-excerpt">
      {{ post.excerpt }}
    </div>

    <div class="post-content" style="display:none;">
      {% include post-meta.html post=post %}
    </div>
  </article>
{% endfor %}
</div>

<script>
// 1. Tangkap SEMUA klik link internal
document.addEventListener('click', e => {
    // cari elemen <a> terdekat (bisa dari child element)
    let a = e.target.closest('a');
    if (!a) return;

    const href = a.getAttribute('href');
    if (!href) return;

    // Abaikan link eksternal, download, mailto, javascript:, target=_blank, dll
    if (
        a.hasAttribute('download') ||
        a.hasAttribute('target') && a.target !== '_self' ||
        href.startsWith('http') && !href.startsWith(location.origin) ||
        href.startsWith('mailto:') ||
        href.startsWith('tel:') ||
        href.startsWith('#') ||           // hash link biasa
        href.startsWith('javascript:')
    ) {
        return;
    }

    // Ini link internal â†’ intercept
    e.preventDefault();
    const targetUrl = new URL(href, location.origin).pathname;

    history.pushState(null, '', targetUrl);
    router();           // panggil router manual setelah pushState
});

// 2. Perbaiki router agar lebih robust
function router() {
    const path = location.pathname;

    // Prioritas: cek apakah ini URL post
    const post = [...posts].find(p => p.dataset.url === path);
    if (post) {
        showPost(path);
        return;
    }

    // Cek hash (untuk tombol blog)
    if (location.hash === '#blog') {
        showList();
        return;
    }

    // Default: homepage
    showHome();
}

// 3. Panggil router juga saat pushState (sudah ditambahkan di klik handler)
//    dan tetap dengarkan popstate
window.addEventListener('popstate', router);

// Panggil sekali saat load
router();
</script>
