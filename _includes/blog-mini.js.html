<div id="page-404" style="display:none;">
    <h1>404</h1>
    <p>Halaman tidak ditemukan.</p>
    <a href="/">Kembali ke Home</a>
</div>

<div id="posts" style="display:none;">
{% for post in site.posts %}
  <article class="post" data-url="{{ post.url | relative_url }}">
    <h2 class="post-title">
      <a href="{{ post.url | relative_url }}">{{ post.title }}</a>
    </h2>

    <div class="post-excerpt">
      {{ post.excerpt }}
    </div>

    <div class="post-content" style="display:none;">
      {% include post-meta.html post=post %}
    </div>
  </article>
{% endfor %}
</div>

<script>
// Deklarasikan variabel di scope luar
let btn, homepage, postsWrap, posts;

document.addEventListener('DOMContentLoaded', () => {
    btn        = document.getElementById('open-blog');
    homepage   = document.querySelector('.homepage');
    postsWrap  = document.getElementById('posts');
    posts      = document.querySelectorAll('.post');     // ← simpan di sini

    // ... (fungsi showHome, showList, showPost tetap sama)

    // Event listener tombol & judul post tetap sama
    btn.addEventListener('click', () => {
        location.hash = 'blog';
    });

    posts.forEach(post => {
        const link = post.querySelector('.post-title a');
        if (!link) return;
        link.addEventListener('click', e => {
            e.preventDefault();
            const url = post.dataset.url;
            history.pushState(null, '', url);
            router();                    // ← panggil router setelah pushState
        });
    });

    // Router tetap sama, sekarang bisa akses posts
    function router() {
        const path = location.pathname;
        const hash = location.hash;

        if (hash === '#blog') {
            showList();
            return;
        }

        const post = Array.from(posts).find(p => p.dataset.url === path);
        if (post) {
            showPost(path);
            return;
        }

        showHome();
    }

    window.addEventListener('popstate', router);
    window.addEventListener('hashchange', router);

    router(); // initial call
});

// Optional: pencegatan link internal (seperti saran sebelumnya)
document.addEventListener('click', e => {
    const a = e.target.closest('a');
    if (!a) return;

    const href = a.getAttribute('href');
    if (!href || href.startsWith('http') || href.startsWith('#') || href.startsWith('mailto:')) return;

    e.preventDefault();
    const target = new URL(href, location.origin).pathname;
    history.pushState(null, '', target);
    router();
});
</script>
