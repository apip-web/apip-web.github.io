<style>
  #spa-home { display: block; }
  #posts { display: none; }
</style>

<div id="page-404" style="display:none;">
    <h1>404</h1>
    <p>Halaman tidak ditemukan.</p>
    <a href="/">Kembali ke Home</a>
</div>

<div id="posts" style="display:none;">
{% for post in site.posts %}
  <article class="post" data-url="{{ post.url | relative_url }}">
    <h2 class="post-title">
      <a href="{{ post.url | relative_url }}">{{ post.title }}</a>
    </h2>

    <div class="post-content" style="display:none;">
      {% include post-meta.html post=post %}
    </div>
  </article>
{% endfor %}
</div>

<div id="spa-debug" style="
  position: fixed;
  max-height: 100px;
  overflow: auto;
  bottom: 10px;
  right: 10px;
  padding: 8px 10px;
  font: 12px monospace;
  background: rgba(0,0,0,.75);
  color: lightgreen;
  z-index: 9999;
  border-radius: 4px;
"></div>

<style>
  #spa-home { display: block; }
  #posts { display: none; }
  .post-content { display: none; }
  #spa-debug {
    position: fixed;
    max-height: 100px;
    overflow: auto;
    bottom: 10px;
    right: 10px;
    padding: 8px 10px;
    font: 12px monospace;
    background: rgba(0,0,0,.75);
    color: lightgreen;
    z-index: 9999;
    border-radius: 4px;
    cursor: pointer;
  }
</style>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const homepage = document.querySelector('.homepage');
  const postsWrap = document.getElementById('posts');
  const debugBox = document.getElementById('spa-debug');
  let STATE = '';

  function getPosts() {
    return [...document.querySelectorAll('.post')];
  }

  const safe = (el, fn) => el && fn(el);

  function hideAllPosts() {
    getPosts().forEach(p => {
      p.style.display = 'none';
      const c = p.querySelector('.post-content');
      const a = p.querySelector('.post-title a');
      if(c) c.style.display = 'none';
      if(a) a.style.display = '';
    });
    safe(postsWrap, el => el.style.display = 'none');
    safe(homepage, el => el.style.display = 'none');
  }

  function showHome() {
    hideAllPosts();
    safe(homepage, el => el.style.display = 'block');
    STATE = 'home';
    debug();
  }

  function showList() {
    hideAllPosts();
    safe(postsWrap, el => el.style.display = 'block');
    getPosts().forEach(p => p.style.display = 'block');
    STATE = 'list';
    debug();
  }

  function showPost(post) {
    hideAllPosts();
    safe(postsWrap, el => el.style.display = 'block');
    post.style.display = 'block';
    const c = post.querySelector('.post-content');
    const a = post.querySelector('.post-title a');
    if(c) c.style.display = 'block';
    if(a) a.style.display = 'none';
    STATE = 'post';
    debug();
  }

  /* ---------------- link/tab handling ---------------- */

  // klik semua link post
  getPosts().forEach(p => {
    const a = p.querySelector('.post-title a');
    if(!a) return;
    a.addEventListener('click', e => {
      e.preventDefault();
      showPost(p);
    });
  });

  // tombol buka list / blog
  const btn = document.getElementById('open-blog');
  if(btn) {
    btn.addEventListener('click', e => {
      e.preventDefault();
      showList();
    });
  }

  // klik homepage
  const homeLinks = document.querySelectorAll('a[href="/"]');
  homeLinks.forEach(a => {
    a.addEventListener('click', e => {
      e.preventDefault();
      showHome();
    });
  });

  /* ---------------- debug overlay ---------------- */

  function debug() {
    if(!debugBox) return;
    debugBox.innerHTML = '';
    debugBox.innerHTML += `<hr><b>STATE:</b> ${STATE}<br>`;
    debugBox.innerHTML += `<b>Visible Posts:</b><br>`;
    getPosts().forEach(p => {
      const visible = p.style.display !== 'none';
      debugBox.innerHTML += `[${visible ? 'SHOW' : 'HIDE'}] ${p.dataset.url}<br>`;
    });
  }

  // klik overlay â†’ copy seluruh HTML debug
  if(debugBox) {
    debugBox.addEventListener('click', () => {
      navigator.clipboard.writeText(debugBox.innerHTML)
        .then(() => {
          debugBox.innerHTML += `<br><i>Copied debug overlay! ðŸ“‹</i>`;
        });
    });
  }

  /* ---------------- init ---------------- */

  // inisialisasi SPA, tampilkan homepage
  showHome();
});
</script>
